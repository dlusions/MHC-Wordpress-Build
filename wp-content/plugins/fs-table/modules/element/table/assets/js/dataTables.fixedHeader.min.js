/**
 * @summary     FixedHeader
 * @description Fix a table's header or footer, so it is always visible while
 *              scrolling
 * @version     3.4.0
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk
 * @copyright   SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */
var _instCounter=0,FixedHeader=function(t,e){if(!(this instanceof FixedHeader))throw"FixedHeader must be initialised with the 'new' keyword.";!0===e&&(e={}),t=new DataTable.Api(t),this.c=$.extend(!0,{},FixedHeader.defaults,e),this.s={dt:t,position:{theadTop:0,tbodyTop:0,tfootTop:0,tfootBottom:0,width:0,left:0,tfootHeight:0,theadHeight:0,windowHeight:$(window).height(),visible:!0},headerMode:null,footerMode:null,autoWidth:t.settings()[0].oFeatures.bAutoWidth,namespace:".dtfc"+_instCounter++,scrollLeft:{header:-1,footer:-1},enable:!0,autoDisable:!1},this.dom={floatingHeader:null,thead:$(t.table().header()),tbody:$(t.table().body()),tfoot:$(t.table().footer()),header:{host:null,floating:null,floatingParent:$('<div class="dtfh-floatingparent">'),placeholder:null},footer:{host:null,floating:null,floatingParent:$('<div class="dtfh-floatingparent">'),placeholder:null}},this.dom.header.host=this.dom.thead.parent(),this.dom.footer.host=this.dom.tfoot.parent();var o=t.settings()[0];if(o._fixedHeader)throw"FixedHeader already initialised on table "+o.nTable.id;o._fixedHeader=this,this._constructor()};$.extend(FixedHeader.prototype,{destroy:function(){var t=this.dom;this.s.dt.off(".dtfc"),$(window).off(this.s.namespace),t.header.rightBlocker&&t.header.rightBlocker.remove(),t.header.leftBlocker&&t.header.leftBlocker.remove(),t.footer.rightBlocker&&t.footer.rightBlocker.remove(),t.footer.leftBlocker&&t.footer.leftBlocker.remove(),this.c.header&&this._modeChange("in-place","header",!0),this.c.footer&&t.tfoot.length&&this._modeChange("in-place","footer",!0)},enable:function(t,e,o){this.s.enable=t,this.s.enableType=o,(e||void 0===e)&&(this._positions(),this._scroll(!0))},enabled:function(){return this.s.enable},headerOffset:function(t){return void 0!==t&&(this.c.headerOffset=t,this.update()),this.c.headerOffset},footerOffset:function(t){return void 0!==t&&(this.c.footerOffset=t,this.update()),this.c.footerOffset},update:function(t){var e=this.s.dt.table().node();(this.s.enable||this.s.autoDisable)&&($(e).is(":visible")?(this.s.autoDisable=!1,this.enable(!0,!1)):(this.s.autoDisable=!0,this.enable(!1,!1)),0!==$(e).children("thead").length&&(this._positions(),this._scroll(void 0===t||t)))},_constructor:function(){var t=this,e=this.s.dt;$(window).on("scroll"+this.s.namespace,(function(){t._scroll()})).on("resize"+this.s.namespace,DataTable.util.throttle((function(){t.s.position.windowHeight=$(window).height(),t.update()}),50));var o=$(".fh-fixedHeader");!this.c.headerOffset&&o.length&&(this.c.headerOffset=o.outerHeight());var i=$(".fh-fixedFooter");!this.c.footerOffset&&i.length&&(this.c.footerOffset=i.outerHeight()),e.on("column-reorder.dt.dtfc column-visibility.dt.dtfc column-sizing.dt.dtfc responsive-display.dt.dtfc",(function(e,o){t.update()})).on("draw.dt.dtfc",(function(o,i){t.update(i!==e.settings()[0])})),e.on("destroy.dtfc",(function(){t.destroy()})),this._positions(),this._scroll()},_clone:function(t,e){var o=this,i=this.s.dt,s=this.dom[t],a="header"===t?this.dom.thead:this.dom.tfoot;if("footer"!==t||!this._scrollEnabled())if(!e&&s.floating)s.floating.removeClass("fixedHeader-floating fixedHeader-locked");else{s.floating&&(null!==s.placeholder&&s.placeholder.remove(),this._unsize(t),s.floating.children().detach(),s.floating.remove());var d=$(i.table().node()),r=$(d.parent()),n=this._scrollEnabled();s.floating=$(i.table().node().cloneNode(!1)).attr("aria-hidden","true").css({"table-layout":"fixed",top:0,left:0}).removeAttr("id").append(a),s.floatingParent.css({width:r.width(),overflow:"hidden",height:"fit-content",position:"fixed",left:n?d.offset().left+r.scrollLeft():0}).css("header"===t?{top:this.c.headerOffset,bottom:""}:{top:"",bottom:this.c.footerOffset}).addClass("footer"===t?"dtfh-floatingparentfoot":"dtfh-floatingparenthead").append(s.floating).appendTo("body"),this._stickyPosition(s.floating,"-");var f=function(){var t=r.scrollLeft();o.s.scrollLeft={footer:t,header:t},s.floatingParent.scrollLeft(o.s.scrollLeft.header)};f(),r.off("scroll.dtfh").on("scroll.dtfh",f),s.placeholder=a.clone(!1),s.placeholder.find("*[id]").removeAttr("id"),s.host.prepend(s.placeholder),this._matchWidths(s.placeholder,s.floating)}},_stickyPosition:function(t,e){if(this._scrollEnabled()){var o=this,i="rtl"===$(o.s.dt.table().node()).css("direction");t.find("th").each((function(){if("sticky"===$(this).css("position")){var t=$(this).css("right"),s=$(this).css("left");if("auto"===t||i){if("auto"!==s&&i){a=+s.replace(/px/g,"")+("-"===e?-1:1)*o.s.dt.settings()[0].oBrowser.barWidth;$(this).css("left",a>0?a:0)}}else{var a=+t.replace(/px/g,"")+("-"===e?-1:1)*o.s.dt.settings()[0].oBrowser.barWidth;$(this).css("right",a>0?a:0)}}}))}},_matchWidths:function(t,e){var o=function(e){return $(e,t).map((function(){return 1*$(this).css("width").replace(/[^\d\.]/g,"")})).toArray()},i=function(t,o){$(t,e).each((function(t){$(this).css({width:o[t],minWidth:o[t]})}))},s=o("th"),a=o("td");i("th",s),i("td",a)},_unsize:function(t){var e=this.dom[t].floating;e&&("footer"===t||"header"===t&&!this.s.autoWidth)?$("th, td",e).css({width:"",minWidth:""}):e&&"header"===t&&$("th, td",e).css("min-width","")},_horizontal:function(t,e){var o=this.dom[t],i=(this.s.position,this.s.scrollLeft);if(o.floating&&i[t]!==e){if(this._scrollEnabled()){var s=$($(this.s.dt.table().node()).parent()).scrollLeft();o.floating.scrollLeft(s),o.floatingParent.scrollLeft(s)}i[t]=e}},_modeChange:function(t,e,o){this.s.dt;var i=this.dom[e],s=this.s.position,a=this._scrollEnabled();if("footer"!==e||!a){var d=function(t){i.floating.attr("style",(function(e,o){return(o||"")+"width: "+t+"px !important;"})),a||i.floatingParent.attr("style",(function(e,o){return(o||"")+"width: "+t+"px !important;"}))},r=this.dom["footer"===e?"tfoot":"thead"],n=$.contains(r[0],document.activeElement)?document.activeElement:null,f=$($(this.s.dt.table().node()).parent());if("in-place"===t)i.placeholder&&(i.placeholder.remove(),i.placeholder=null),this._unsize(e),"header"===e?i.host.prepend(r):i.host.append(r),i.floating&&(i.floating.remove(),i.floating=null,this._stickyPosition(i.host,"+")),i.floatingParent&&i.floatingParent.remove(),$($(i.host.parent()).parent()).scrollLeft(f.scrollLeft());else if("in"===t){this._clone(e,o);var h=f.offset(),l=$(document).scrollTop(),c=l+$(window).height(),p=a?h.top:s.tbodyTop,g=a?h.top+f.outerHeight():s.tfootTop,u="footer"===e?p>c?s.tfootHeight:p+s.tfootHeight-c:l+this.c.headerOffset+s.theadHeight-g,b="header"===e?"top":"bottom",m=this.c[e+"Offset"]-(u>0?u:0);i.floating.addClass("fixedHeader-floating"),i.floatingParent.css(b,m).css({left:s.left,height:"header"===e?s.theadHeight:s.tfootHeight,"z-index":2}).append(i.floating),d(s.width),"footer"===e&&i.floating.css("top","")}else"below"===t?(this._clone(e,o),i.floating.addClass("fixedHeader-locked"),i.floatingParent.css({position:"absolute",top:s.tfootTop-s.theadHeight,left:s.left+"px"}),d(s.width)):"above"===t&&(this._clone(e,o),i.floating.addClass("fixedHeader-locked"),i.floatingParent.css({position:"absolute",top:s.tbodyTop,left:s.left+"px"}),d(s.width));n&&n!==document.activeElement&&setTimeout((function(){n.focus()}),10),this.s.scrollLeft.header=-1,this.s.scrollLeft.footer=-1,this.s[e+"Mode"]=t}},_positions:function(){var t=this.s.dt,e=t.table(),o=this.s.position,i=this.dom,s=$(e.node()),a=this._scrollEnabled(),d=$(t.table().header()),r=$(t.table().footer()),n=i.tbody,f=s.parent();o.visible=s.is(":visible"),o.width=s.outerWidth(),o.left=s.offset().left,o.theadTop=d.offset().top,o.tbodyTop=a?f.offset().top:n.offset().top,o.tbodyHeight=a?f.outerHeight():n.outerHeight(),o.theadHeight=d.outerHeight(),o.theadBottom=o.theadTop+o.theadHeight,r.length?(o.tfootTop=o.tbodyTop+o.tbodyHeight,o.tfootBottom=o.tfootTop+r.outerHeight(),o.tfootHeight=r.outerHeight()):(o.tfootTop=o.tbodyTop+n.outerHeight(),o.tfootBottom=o.tfootTop,o.tfootHeight=o.tfootTop)},_scroll:function(t){if(!this.s.dt.settings()[0].bDestroying){var e,o,i=this._scrollEnabled(),s=(u=$(this.s.dt.table().node()).parent()).offset(),a=u.outerHeight(),d=$(document).scrollLeft(),r=$(document).scrollTop(),n=$(window).height(),f=this.s.position,h=i?s.top:f.tbodyTop,l=i?s.left:f.left,c=i?s.top+a:f.tfootTop,p=i?u.outerWidth():f.tbodyWidth,g=r+n;if(this.c.header){if(this.s.enable)if(!f.visible||r+this.c.headerOffset+f.theadHeight<=h)e="in-place";else if(r+this.c.headerOffset+f.theadHeight>h&&r+this.c.headerOffset+f.theadHeight<c){e="in";var u=$($(this.s.dt.table().node()).parent());r+this.c.headerOffset+f.theadHeight>c||void 0===this.dom.header.floatingParent?t=!0:this.dom.header.floatingParent.css({top:this.c.headerOffset,position:"fixed"}).append(this.dom.header.floating)}else e="below";else e="in-place";(t||e!==this.s.headerMode)&&this._modeChange(e,"header",t),this._horizontal("header",d)}var b={offset:{top:0,left:0},height:0},m={offset:{top:0,left:0},height:0};if(this.c.footer&&this.dom.tfoot.length){this.s.enable?!f.visible||f.tfootBottom+this.c.footerOffset<=g?o="in-place":c+f.tfootHeight+this.c.footerOffset>g&&h+this.c.footerOffset<g?(o="in",t=!0):o="above":o="in-place",(t||o!==this.s.footerMode)&&this._modeChange(o,"footer",t),this._horizontal("footer",d);var v=function(t){return{offset:t.offset(),height:t.outerHeight()}};if(b=this.dom.header.floating?v(this.dom.header.floating):v(this.dom.thead),m=this.dom.footer.floating?v(this.dom.footer.floating):v(this.dom.tfoot),i&&m.offset.top>r){var H=r-s.top,x=g+(H>-b.height?H:0)-(b.offset.top+(H<-b.height?b.height:0)+m.height);x<0&&(x=0),u.outerHeight(x),Math.round(u.outerHeight())>=Math.round(x)?$(this.dom.tfoot.parent()).addClass("fixedHeader-floating"):$(this.dom.tfoot.parent()).removeClass("fixedHeader-floating")}}if(this.dom.header.floating&&this.dom.header.floatingParent.css("left",l-d),this.dom.footer.floating&&this.dom.footer.floatingParent.css("left",l-d),void 0!==this.s.dt.settings()[0]._fixedColumns){var _=function(t,o,i){if(void 0===i){var s=$("div.dtfc-"+t+"-"+o+"-blocker");i=0===s.length?null:s.clone().css("z-index",1)}return null!==i&&("in"===e||"below"===e?i.appendTo("body").css({top:"top"===o?b.offset.top:m.offset.top,left:"right"===t?l+p-i.width():l}):i.detach()),i};this.dom.header.rightBlocker=_("right","top",this.dom.header.rightBlocker),this.dom.header.leftBlocker=_("left","top",this.dom.header.leftBlocker),this.dom.footer.rightBlocker=_("right","bottom",this.dom.footer.rightBlocker),this.dom.footer.leftBlocker=_("left","bottom",this.dom.footer.leftBlocker)}}},_scrollEnabled:function(){var t=this.s.dt.settings()[0].oScroll;return""!==t.sY||""!==t.sX}}),FixedHeader.version="3.4.0",FixedHeader.defaults={header:!0,footer:!1,headerOffset:0,footerOffset:0},$.fn.dataTable.FixedHeader=FixedHeader,$.fn.DataTable.FixedHeader=FixedHeader,$(document).on("init.dt.dtfh",(function(t,e,o){if("dt"===t.namespace){var i=e.oInit.fixedHeader,s=DataTable.defaults.fixedHeader;if((i||s)&&!e._fixedHeader){var a=$.extend({},s,i);!1!==i&&new FixedHeader(e,a)}}})),DataTable.Api.register("fixedHeader()",(function(){})),DataTable.Api.register("fixedHeader.adjust()",(function(){return this.iterator("table",(function(t){var e=t._fixedHeader;e&&e.update()}))})),DataTable.Api.register("fixedHeader.enable()",(function(t){return this.iterator("table",(function(e){var o=e._fixedHeader;t=void 0===t||t,o&&t!==o.enabled()&&o.enable(t)}))})),DataTable.Api.register("fixedHeader.enabled()",(function(){if(this.context.length){var t=this.context[0]._fixedHeader;if(t)return t.enabled()}return!1})),DataTable.Api.register("fixedHeader.disable()",(function(){return this.iterator("table",(function(t){var e=t._fixedHeader;e&&e.enabled()&&e.enable(!1)}))})),$.each(["header","footer"],(function(t,e){DataTable.Api.register("fixedHeader."+e+"Offset()",(function(t){var o=this.context;return void 0===t?o.length&&o[0]._fixedHeader?o[0]._fixedHeader[e+"Offset"]():void 0:this.iterator("table",(function(o){var i=o._fixedHeader;i&&i[e+"Offset"](t)}))}))}));