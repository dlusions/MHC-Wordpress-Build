/* Essentials YOOtheme Pro 2.4.12 build 1202.1125; ZOOlanders https://www.zoolanders.com; Copyright (C) Joolanders, SL; http://www.gnu.org/licenses/gpl.html GNU/GPL */

(function(m,w,d,$,c,f){"use strict";function v(s,e,t,n,r,i,u,l){var a=typeof s=="function"?s.options:s;return e&&(a.render=e,a.staticRenderFns=t,a._compiled=!0),{exports:s,options:a}}const k={props:{panel:{type:Object,default:()=>({})}},computed:{Config(){return d.helpers.Config}},methods:{downloadDebugData(){const s=w.config.route+`&p=${encodeURIComponent("yooessentials/debug/data")}`;window.open(s)}}};var C=function(){var e=this,t=e._self._c;return t("div",[t("fields-panel",{attrs:{panel:e.panel,values:e.Config.values}}),e._v(" "),t("div",{staticClass:"uk-margin-large"},[t("button",{staticClass:"uk-button uk-button-default uk-width-1-1",attrs:{type:"button"},on:{click:e.downloadDebugData}},[e._v(`
            `+e._s(e.$t("Download Data"))+`
        `)]),e._v(" "),t("p",{staticClass:"uk-margin"},[e._v(`
            `+e._s(e.$t("Generates a ZIP with information about the site and theme configuration. Sensitive data might be included, be carefull who you share this with."))+`
        `)])])],1)},E=[],D=v(k,C,E),B=D.exports;const P={name:"LayoutEditor",props:{builder:Object},data:()=>({source:null}),computed:{value(){return JSON.stringify(this.source,null,4)}},watch:{source:{handler(){this.editor.state.doc.toString()!==this.value&&this.editor.dispatch({changes:{from:0,to:this.editor.state.doc.length,insert:this.value||""}})},deep:!0}},mounted(){const s=c.EditorView.theme({".cm-scroller":{height:"100vh"}});this.editor=c.createEditor({parent:this.$refs.editor,onChange:()=>{this.foldJsonAttribute(this.editor,"children")},setup:[s,c.json(),c.codeFolding(),c.lineNumbers(),c.EditorState.readOnly.of(!0),c.syntaxHighlighting(c.defaultHighlightStyle,{fallback:!0})]})},destroyed(){this.editor.destroy()},methods:{foldJsonAttribute(s,e,t=!1){const n=s.state.doc.toString(),r=new RegExp(`"${e}":\\s*([\\[\\{])`,"g");let i;const u=[];for(;(i=r.exec(n))!==null;){if(t){const _=n.substring(0,i.index);if(this.getJsonDepth(_)!==1)continue}const l=i.index+i[0].length,a=i[1],b=a==="["?"]":"}";if(n[l]===b)continue;let h=1,p=l;for(;p<n.length&&h>0;)n[p]===a&&h++,n[p]===b&&h--,p++;if(h===0){const _=p-1;u.push({from:l,to:_})}}if(u.length>0){const l=u.map(a=>c.foldEffect.of(a));s.dispatch({effects:l})}},getJsonDepth(s){let e=0;for(let t=0;t<s.length;t++)s[t]==="{"||s[t]==="["?e++:(s[t]==="}"||s[t]==="]")&&e--;return e}}};var L=function(){var e=this,t=e._self._c;return t("div",{staticClass:"yo-preview-iframe uk-margin-auto uk-margin-auto-vertical uk-overflow-auto"},[t("button",{staticClass:"uk-modal-close-default uk-position-fixed",attrs:{type:"button","uk-close":""},on:{click:function(n){return e.$trigger("toggleLayoutEditor")}}}),e._v(" "),t("div",{ref:"editor",staticClass:"uk-animation-fade"})])},O=[],x=v(P,L,O),R=x.exports;const S={name:"LayoutEditorButton",props:{instance:Object},data:()=>({active:!1}),created(){this.instance&&(this.active=!0)},events:{toggleLayoutEditor(){this.active=!this.active}}};var W=function(){var e=this,t=e._self._c;return t("button",{staticClass:"uk-button uk-button-small uk-button-default uk-active",attrs:{type:"button"},on:{click:function(n){return e.$trigger("toggleLayoutEditor")}}},[t("span",{attrs:{ratio:"0.8","uk-icon":e.active?"close":"code"}})])},j=[],F=v(S,W,j),J=F.exports;let o=null;$.before("app.init",({extend:s})=>{s({events:{layoutButtons:{handler({result:e=[]}){return d.helpers.Config.get("debug.layout")?[...e,{component:J,instance:o}]:e},priority:-10},toggleLayoutEditor(){var r,i,u;const{Sidebar:e,Builder:t}=d.yoo;if(o){y();return}const n=(e==null?void 0:e.panel)||{};if((r=n.props)!=null&&r.template){g(n.props.template.layout);return}if((i=n.props)!=null&&i.current){g(t.node);return}g((u=n.props)==null?void 0:u.node)},openPanel(e,t){var n;if(!(!o||!((n=t.props)!=null&&n.node))){if(t.name.startsWith("yooessentials-composed")){o.source=t.props.values;return}if(t.name.startsWith("yooessentials-access-condition")){o.source=t.props.values.yooessentials_access_conditions;return}if(t.name.startsWith("yooessentials-form-settings")){o.source=t.props.values.yooessentials_form;return}if(t.name.startsWith("yooessentials-source")){o.source=t.props.values;return}o.source=t.props.node}},closePanel(e,t,n,r){var i,u,l,a;if(o){if(n.name.match(/builder|template-builder/)){y();return}if(r.name.startsWith("yooessentials-access-condition")){o.source=r.props.values.yooessentials_access_conditions;return}if(r.name.startsWith("yooessentials-form-settings")){o.source=r.props.values.yooessentials_form;return}(i=r.props)!=null&&i.template?o.source=r.props.template.layout:(u=r.props)!=null&&u.current?o.source=d.yoo.Builder.node:(l=r.props)!=null&&l.node&&(o.source=(a=r.props)==null?void 0:a.node)}},resetNode(){o&&(o.source=d.yoo.Builder.node)},loadPreview:{handler(e,{loadedPage:t}={}){var n,r;if(o&&(n=o==null?void 0:o.source)!=null&&n.version&&f.isEmpty((r=o==null?void 0:o.source)==null?void 0:r.children)&&(o.source=d.yoo.Builder.node),o&&t)return!1},priority:99}}})});function g(s){f.addClass(f.$(".yo-preview-iframe"),"uk-hidden"),o=new m({extends:R,propsData:{builder:d.yoo.Builder}}).$mount(),o.source=s,document.getElementsByClassName("yo-preview")[0].append(o.$el)}function y(){o&&(f.remove(o.$el),o.$destroy(),f.removeClass(f.$(".yo-preview-iframe"),"uk-hidden"),o=null,m.events.trigger("loadPreview"))}m.component("yooessentials-debug-panel",B)})(Vue,yootheme,yooessentials,yootheme.hooks,yooessentials.codemirror,UIkit.util);
